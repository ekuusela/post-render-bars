<html>
    <head>
        <script src="lib/webcomponents-lite.min.js"></script> <!-- polyfill for MutationObserver -->
        <script src="lib/handlebars-v4.0.5.js"></script>

        <script src="templates/templates.js"></script> <!-- pre-compiled templates -->
        <script src="../watch.js"></script>
        <script src="../postHandlebars.js"></script>
        <style>
            body { font-family: sans-serif; font-size: 16px; }
            code { font-size: 14px; }
            .result { background-color: #eee; margin-bottom: 4em }
            h2 { color: #555; }
        </style>
    </head>
    <body>
        <p>Examples of how to use post-render-bars utilities. View source for more details and comments.</p>
        <p><a href="withjquery.html">Examples for use with jQuery</a></p>
        <a href="https://github.com/ekuusela/post-render-bars">View the Project on GitHub <small>ekuusela/post-render-bars</small></a>
    
        <h2>Example 1: post render and activator</h2>
        <p><a href="templates/list.handlebars">list.handlebars</a> is a template used for rendering multiple entries using the <a href="templates/entry.handlebars">entry.handlebars</a> partial. We use <code>postHandlebars</code> for two things:
        <p>
        - add click handler to the entry partial every time its used<br>
        - replace the word "my" with the word "your" in the entire rendered output<br>
        </p>
        <p>We pass in:<br><code><pre>
        {
            title: 'this is my list',
            entries: [
                {title: 'Here is my title', body: 'and my button'},
                {title: 'Here is my 2nd title', body: 'and my 2nd button'}
            ]
        }
        </pre></code></p>
        <p>and get the result:<p>
        <div id="example1" class="result"></div>

        <h2>Example 2a: post render function</h2>
        <p>using templates compiled at runtime</p>
        <div id="example2a" class="result"></div>

        <h2>Example 2b: post render function</h2>
        <p>using templates compiled at runtime, alternative</p>
        <div id="example2b" class="result"></div>
        <script id="italics-template" type="text/x-handlebars-template">
            this will be in italics: <i>{{content}}</i>
        </script>

        <h2>Example 3: one way data-binding</h2>
        <p>using <code>renderer</code> helper to update content in a template after rendering it</p>
        <div id="example3" class="result"></div>
        <script id="dynamic-template" type="text/x-handlebars-template">
            this will be updated {{#renderer time}}<span>waiting</span>{{/renderer}}
        </script>

        <script type="text/javascript">
            // create some post render functions
            var allCaps = function(html) { return html.toUpperCase(); };
            var replaceMy = function(html) { return html.replace(/my/gi, 'your') };
            var replaceContent = function(html) { return html.replace(/content/gi, 'replaced content') };

            // register everything as partials
            Handlebars.partials = Handlebars.templates;

            // Example 1: add some post render functions to pre-compiled templates
            // these templates were compiled by executing
            // handlebars *.handlebars -f templates.js
            postHandlebars.registerPostRender('list', replaceMy);

            postHandlebars.registerActivator('entry', function(element) {
                var button = element.querySelectorAll('.counter')[0];
                var i = 0;
                button.addEventListener('click', function() {
                    button.innerHTML = ++i;
                });
            });

            var listContainer = document.getElementById('example1');
            listContainer.innerHTML = Handlebars.templates['list']({
                    title: 'this is my list',
                    entries: [
                        {title: 'Here is my title', body: 'and my button'},
                        {title: 'Here is my 2nd title', body: 'and my 2nd button'}
                    ]
                });

            // Example 2a: templates compiled at runtime
            postHandlebars.registerPostRender('italics-template', replaceContent);
            Handlebars.templates['italics-template'] = Handlebars.compile(document.getElementById('italics-template').innerHTML);
            var italicsAContainer = document.getElementById('example2a');
            italicsAContainer.innerHTML = Handlebars.templates['italics-template']({content: 'content'});

            // Example 2b: templates compiled at runtime, alternative
            var source = document.getElementById('italics-template').innerHTML;
            var templateB = Handlebars.compile(source);
            templateB = postHandlebars.appendPostRenderFn(templateB, allCaps);
            var italicsBContainer = document.getElementById('example2b');
            italicsBContainer.innerHTML = templateB({content: 'content'});

            // Example 3: using renderer helper to update content in a template after rendering it
            Handlebars.templates['dynamic-template'] = Handlebars.compile(document.getElementById('dynamic-template').innerHTML);
            var dynamicContainer = document.getElementById('example3');
            var timeRenderer = postHandlebars.createRenderer(function() { return new Date(); });
            dynamicContainer.innerHTML = Handlebars.templates['dynamic-template']({time: timeRenderer});
            setInterval(timeRenderer, 2000);
        </script>
    </body>
</html>